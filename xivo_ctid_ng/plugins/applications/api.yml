paths:
  /applications/{application_uuid}:
    get:
      summary: Show an application
      description: '**Required ACL:** `ctid-ng.applications.{application_uuid}.read`'
      parameters:
      - $ref: '#/parameters/ApplicationUUID'
      tags:
      - applications
      responses:
        '200':
          description: Application
          schema:
            $ref: '#/definitions/Application'
        '404':
          description: No such application
          schema:
            $ref: '#/definitions/Error'
        '503':
          $ref: '#/responses/AnotherServiceUnavailable'

  /applications/{application_uuid}/calls:
    get:
      summary: List calls from the application
      description: '**Required ACL:** `ctid-ng.applications.{application_uuid}.calls.read`'
      parameters:
      - $ref: '#/parameters/ApplicationUUID'
      tags:
      - applications
      responses:
        '200':
          description: Application
          schema:
            $ref: '#/definitions/ApplicationCalls'
        '404':
          description: No such application
          schema:
            $ref: '#/definitions/Error'
        '503':
          $ref: '#/responses/AnotherServiceUnavailable'
    post:
      summary: Make a new call to the application
      description: '**Required ACL:** `ctid-ng.applications.{application_uuid}.calls.create`'
      parameters:
      - $ref: '#/parameters/ApplicationUUID'
      - name: body
        in: body
        description: node parameters
        required: true
        schema:
          $ref: '#/definitions/ApplicationCallRequest'
      tags:
      - applications
      responses:
        '201':
          description: The new call ID
          schema:
            $ref: '#/definitions/ApplicationCall'
        '400':
          description: Invalid request
          schema:
            $ref: '#/definitions/Error'
        '503':
          $ref: '#/responses/AnotherServiceUnavailable'

  /applications/{application_uuid}/calls/{call_id}:
    delete:
      summary: Hangup a call from the application
      description: '**Required ACL:** `ctid-ng.applications.{application_uuid}.calls.{call_id}.delete`'
      parameters:
      - $ref: '#/parameters/ApplicationUUID'
      - $ref: '#/parameters/ApplicationCallID'
      tags:
      - applications
      responses:
        '204':
          description: Call has been hung up
        '404':
          description: No such application or call
          schema:
            $ref: '#/definitions/Error'
        '503':
          $ref: '#/responses/AnotherServiceUnavailable'

  /applications/{application_uuid}/calls/{call_id}/playbacks:
    post:
      summary: Play file to the call
      description: |
       **Required ACL:** `ctid-ng.applications.{application_uuid}.calls.{call_id}.playbacks.create`

       URI examples:

       * sound:tt-weasels
       * digits:4188001234
       * number:321
       * characters:abc
       * tone:ring
       * recording:my-recording
      parameters:
      - $ref: '#/parameters/ApplicationUUID'
      - $ref: '#/parameters/ApplicationCallID'
      - name: body
        in: body
        description: playback parameters
        required: true
        schema:
          $ref: '#/definitions/Playback'
      tags:
      - applications
      responses:
        '200':
          description: Play has been sent
          schema:
            $ref: '#/definitions/Playback'
        '400':
          description: No such playback
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: No such application or call
          schema:
            $ref: '#/definitions/Error'
        '503':
          $ref: '#/responses/AnotherServiceUnavailable'

  /applications/{application_uuid}/nodes:
    get:
      summary: List nodes from the application
      description: '**Required ACL:** `ctid-ng.applications.{application_uuid}.nodes.read`'
      parameters:
      - $ref: '#/parameters/ApplicationUUID'
      tags:
      - applications
      responses:
        '200':
          description: Application
          schema:
            $ref: '#/definitions/ApplicationNodes'
        '404':
          description: No such application
          schema:
            $ref: '#/definitions/Error'
        '503':
          $ref: '#/responses/AnotherServiceUnavailable'


    post:
      summary: Make a new node and add calls
      description: '**Required ACL:** `ctid-ng.applications.{application_uuid}.nodes.create`'
      parameters:
      - $ref: '#/parameters/ApplicationUUID'
      - name: body
        in: body
        description: node parameters
        required: true
        schema:
          $ref: '#/definitions/ApplicationNodeRequest'
      tags:
      - applications
      responses:
        '201':
          description: The new node ID
          schema:
            $ref: '#/definitions/ApplicationNode'
        '400':
          description: Invalid request
          schema:
            $ref: '#/definitions/Error'
        '404':
          description: No such application
          schema:
            $ref: '#/definitions/Error'
        '503':
          $ref: '#/responses/AnotherServiceUnavailable'

  /applications/{application_uuid}/nodes/{node_uuid}:
    get:
      summary: Show a node
      description: '**Required ACL:** `ctid-ng.applications.{application_uuid}.nodes.{node_uuid}.read`'
      parameters:
      - $ref: '#/parameters/ApplicationUUID'
      - $ref: '#/parameters/ApplicationNodeUUID'
      tags:
      - applications
      responses:
        '200':
          description: ApplicationNode
          schema:
            $ref: '#/definitions/ApplicationNode'
        '404':
          description: No such application or node
          schema:
            $ref: '#/definitions/Error'
        '503':
          $ref: '#/responses/AnotherServiceUnavailable'
    delete:
      summary: Delete node and hangup all calls
      description: |
        **Required ACL:** `ctid-ng.applications.{application_uuid}.nodes.{node_uuid}.delete`

        **Not implemented**
      parameters:
      - $ref: '#/parameters/ApplicationUUID'
      - $ref: '#/parameters/ApplicationNodeUUID'
      tags:
      - applications
      responses:
        '204':
          description: Call has been hung up
        '404':
          description: No such application or node
          schema:
            $ref: '#/definitions/Error'
        '503':
          $ref: '#/responses/AnotherServiceUnavailable'

  /applications/{application_uuid}/nodes/{node_uuid}/calls:
    post:
      summary: Make a new call to the node
      description: '**Required ACL:** `ctid-ng.applications.{application_uuid}.nodes.{node_uuid}.calls.create`'
      parameters:
      - $ref: '#/parameters/ApplicationUUID'
      - $ref: '#/parameters/ApplicationNodeUUID'
      - name: body
        in: body
        description: Call parameters
        required: true
        schema:
          $ref: '#/definitions/ApplicationCallRequest'
      tags:
      - applications
      responses:
        '201':
          description: The new call ID
          schema:
            $ref: '#/definitions/ApplicationCall'
        '400':
          description: Invalid request
          schema:
            $ref: '#/definitions/Error'
        '503':
          $ref: '#/responses/AnotherServiceUnavailable'

  /applications/{application_uuid}/nodes/{node_uuid}/calls/{call_id}:
    put:
      summary: Insert call to the node
      description: '**Required ACL:** `ctid-ng.applications.{application_uuid}.nodes.{node_uuid}.calls.{call_id}.update`'
      parameters:
      - $ref: '#/parameters/ApplicationUUID'
      - $ref: '#/parameters/ApplicationNodeUUID'
      - $ref: '#/parameters/ApplicationCallID'
      tags:
      - applications
      responses:
        '204':
          description: Call has been added to the node
        '404':
          description: No such application or node or call
          schema:
            $ref: '#/definitions/Error'
        '503':
          $ref: '#/responses/AnotherServiceUnavailable'
    delete:
      summary: Remove call from the node
      description: '**Required ACL:** `ctid-ng.applications.{application_uuid}.nodes.{node_uuid}.calls.{call_id}.delete`'
      parameters:
      - $ref: '#/parameters/ApplicationUUID'
      - $ref: '#/parameters/ApplicationNodeUUID'
      - $ref: '#/parameters/ApplicationCallID'
      tags:
      - applications
      responses:
        '204':
          description: Call has been removed from the node
        '404':
          description: No such application or node or call
          schema:
            $ref: '#/definitions/Error'
        '503':
          $ref: '#/responses/AnotherServiceUnavailable'
  /applications/{application_uuid}/playbacks/{playback_uuid}:
    delete:
      summary: Stop and remove playback
      description: '**Required ACL:** `ctid-ng.applications.{application_uuid}.playbacks.{playback_uuid}.delete`'
      parameters:
      - $ref: '#/parameters/ApplicationUUID'
      - $ref: '#/parameters/ApplicationPlaybackUUID'
      tags:
      - applications
      responses:
        '204':
          description: Playback has been stopped and removed
        '404':
          description: No such application or playback
          schema:
            $ref: '#/definitions/Error'
        '503':
          $ref: '#/responses/AnotherServiceUnavailable'

definitions:
  Application:
    type: object
    properties:
      destination_node_uuid:
        type: string
  ApplicationCalls:
    type: object
    properties:
      items:
        type: array
        items:
          $ref: '#/definitions/ApplicationCall'
  ApplicationCall:
    type: object
    properties:
      id:
        type: string
      status:
        type: string
      caller_id_name:
        type: string
      caller_id_number:
        type: string
      creation_time:
        type: string
      node_uuid:
        type: string
      on_hold:
        type: boolean
      is_caller:
        type: boolean
      dialed_extension:
        type: string
      variables:
        type: object
  ApplicationCallRequest:
    type: object
    properties:
      exten:
        type: string
      context:
        type: string
      autoanswer:
        type: boolean
        default: false
    required:
      - exten
      - context
  ApplicationNodes:
    type: object
    properties:
      items:
        type: array
        items:
          $ref: '#/definitions/ApplicationNode'
  ApplicationNode:
    type: object
    properties:
      uuid:
        type: string
      calls:
        type: array
        items:
          $ref: '#/definitions/ApplicationCall'
  ApplicationNodeRequest:
    type: object
    properties:
      calls:
        type: array
        items:
          $ref: '#/definitions/ApplicationNodeCallRequest'
  ApplicationNodeCallRequest:
    type: object
    properties:
      id:
        type: string
  Playback:
    type: object
    properties:
      uuid:
        type: string
        readOnly: true
      uri:
        type: string
      language:
        type: string

parameters:
  ApplicationCallID:
    name: call_id
    in: path
    description: ID of the call
    required: true
    type: string
  ApplicationNodeUUID:
    name: node_uuid
    in: path
    description: UUID of the node
    required: true
    type: string
  ApplicationUUID:
    name: application_uuid
    in: path
    description: UUID of the application
    required: true
    type: string
  ApplicationNodeUUID:
    name: node_uuid
    in: path
    description: UUID of the node
    required: true
    type: string
  ApplicationPlaybackUUID:
    name: playback_uuid
    in: path
    description: ID of the playback
    required: true
    type: string
