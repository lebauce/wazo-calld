%%%
%%%               ejabberd configuration file
%%%
%%%'

{loglevel, 5}.
{hosts, ["localhost"] }.

{listen,
 [
  { {8088, "0.0.0.0"} , ejabberd_cowboy, [
      {num_acceptors, 10},
      {max_connections, 1024},
      {modules, [
          {"_", "/api", mongoose_api_admin, []}
      ]}
  ]}
 ]}.


{http_connections, [{xivo_ctid_ng, [{server, "http://ctid-ng:9501"},
                                    {pool_size, 50}, {path_prefix, "/1.0/"}]}]}.

{modules,
 [
  {mod_http_notification, [{pool_name, xivo_ctid_ng}, {path, "/mongooseim/message_callback"}]},

  {mod_adhoc, []},
  {mod_disco, []},
  {mod_commands, []},
  {mod_muc_commands, []},
  {mod_muc_light_commands, []},
  {mod_last, []},
  {mod_stream_management, []},
  {mod_offline, [{access_max_user_messages, max_user_offline_messages}]},
  {mod_privacy, []},
  {mod_blocking, []},
  {mod_private, []},
  {mod_register, [
		  {welcome_message, {""}},
		  {ip_access, [{allow, "127.0.0.0/8"},
                   {deny, "0.0.0.0/0"}]},
		  {access, register}
  ]},
  {mod_roster, []},
  {mod_sic, []},
  {mod_vcard, []}
]}.

{s2s_use_starttls, optional}.
{s2s_certfile, "priv/ssl/fake_server.pem"}.
{s2s_default_policy, deny }.
{outgoing_s2s_port, 5269 }.
{sm_backend, {mnesia, []} }.
{auth_method, internal }.
{auth_opts, []}.

{shaper, normal, {maxrate, 1000}}.
{shaper, fast, {maxrate, 50000}}.
{max_fsm_queue, 1000}.
{acl, local, {user_regexp, ""}}.

{access, max_user_sessions, [{10, all}]}.
{access, max_user_offline_messages, [{5000, admin}, {100, all}]}.
{access, local, [{allow, local}]}.
{access, c2s, [{deny, blocked},
	       {allow, all}]}.
{access, c2s_shaper, [{none, admin},
		      {normal, all}]}.
{access, s2s_shaper, [{fast, all}]}.
{access, muc_admin, [{allow, admin}]}.
{access, muc_create, [{allow, local}]}.
{access, muc, [{allow, all}]}.
{access, register, [{allow, all}]}.
{registration_timeout, infinity}.
{access, mam_set_prefs, [{default, all}]}.
{access, mam_get_prefs, [{default, all}]}.
{access, mam_lookup_messages, [{default, all}]}.
{access, mam_purge_single_message, [{default, all}]}.
{access, mam_purge_multiple_messages, [{default, all}]}.

{shaper, mam_shaper, {maxrate, 1}}.
{shaper, mam_global_shaper, {maxrate, 1000}}.

{access, mam_set_prefs_shaper, [{mam_shaper, all}]}.
{access, mam_get_prefs_shaper, [{mam_shaper, all}]}.
{access, mam_lookup_messages_shaper, [{mam_shaper, all}]}.
{access, mam_purge_single_message_shaper, [{mam_shaper, all}]}.
{access, mam_purge_multiple_messages_shaper, [{mam_shaper, all}]}.

{access, mam_set_prefs_global_shaper, [{mam_global_shaper, all}]}.
{access, mam_get_prefs_global_shaper, [{mam_global_shaper, all}]}.
{access, mam_lookup_messages_global_shaper, [{mam_global_shaper, all}]}.
{access, mam_purge_single_message_global_shaper, [{mam_global_shaper, all}]}.
{access, mam_purge_multiple_messages_global_shaper, [{mam_global_shaper, all}]}.

{language, "en"}.
{all_metrics_are_global, false }.
